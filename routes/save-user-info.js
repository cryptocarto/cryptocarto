/*
* Download a text file with user info
*/

module.exports = async function(req, res, next) {
    try {

      // Redirect to home if no user info
      if ((typeof req.session.address == 'undefined') || (typeof req.session.privatekey == 'undefined')) {
        res.redirect('/');
        return;
      }

      // Generate user data
      var filename = "CryptoCarto_UserData_" + req.session.address + ".txt";
      var userDataText = "Klaytn Wallet Data for address " + req.session.address + 
                        "\nGenerated by CryptoCarto - https://cryptocarto.xyz" + 
                        "\n-----------------------------------------------------------" + 
                        "\nUse your private key at https://app.cryptocarto.xyz/ to see your tokens and get new ones" +
                        "\nBrowse your collection at https://orbexplorer.com/address/?address=" + req.session.address +
                        "\nCheck your Klaytn transactions at https://scope.klaytn.com/account/" + req.session.address +
                        "\n-----------------------------------------------------------" + 
                        "\nUser Address: " + req.session.address + 
                        "\nUser Private Key: " + req.session.privatekey + 
                        "\n-----------------------------------------------------------" + 
                        "\nCONFIDENTIAL DATA - KEEP THIS FILE SAFE - ANYONE WITH ACCESS CAN CONSUME YOUR ASSETS";
      
      // Render textfile
      res.setHeader('Content-disposition', 'attachment; filename=' + filename);
      res.setHeader('Content-type', 'text/plain');
      res.charset = 'UTF-8';
      res.write(userDataText);
      res.end();
      return;
    } catch (error) { next(error) }
  };